<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="assets/icons/Beehive.png" type="image/x-icon">
    <!-- fontAwesome -->
    <script src="https://kit.fontawesome.com/7d521e6e81.js" crossorigin="anonymous"></script>
    <!--  -->

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dosis:wght@300&family=Quicksand:wght@300;400&display=swap"
        rel="stylesheet">
    <!--  -->

    <!-- Js chart -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!--  -->
    <!-- css's -->
    <link rel="stylesheet" href="css/default.css">
    <link rel="stylesheet" href="css/dashboards/styleMaquina.css">
    <!-- css's components -->
    <link rel="stylesheet" href="css/Components/sidebar.css">
    <!-- script -->

    <script>
        window.fwSettings = {
            'widget_id': 150000001309
        };
        !function () { if ("function" != typeof window.FreshworksWidget) { var n = function () { n.q.push(arguments) }; n.q = [], window.FreshworksWidget = n } }() 
    </script>
    <script type='text/javascript' src='https://widget.freshworks.com/widgets/150000001309.js' async defer></script>

    <title>Dashboard | Máquina</title>
</head>

<body onload="listarInformacoesMaquina(), listarDadosMaquina(),iniciarGrafico()">
    <div class="container">

        <!-- Component sideBar -->
        <div class="menuLateral">
            <div class="logo">
                <img class="img-icon" src="./assets/img/Beehive_logo 22 (1).svg" alt=""
                    style="transition: all 0.6s  cubic-bezier(0.125, 0.54, 0.24, 1);">
                <span class="nomeBeehive">Beehive</span>
            </div>
            <hr>
            <div class="itens">
                <div class="item-sidebar">
                    <img src="assets/icons/icon_home.png" alt="">
                    <a href="index.html">
                        <h2 class="item">Home</h2>
                    </a>
                </div>
                <div class="item-sidebar agora">
                    <img src="assets/icons/icon_dashboard.png" alt="">
                    <a href="PrimaryDashboard.html">
                        <h2 class="item">Dashboard</h2>
                    </a>
                </div>
                <div class="item-sidebar">
                    <img class="img-gerenciar-user" src="assets/icons/icon_gerenciar_user.png" alt="">
                    <a href="gerenciarContas.html">
                        <h2 class="item">Gerenciar</h2>
                    </a>
                </div>
                <div class="item-sidebar">
                    <img class="img-gerenciar-user" src="assets/icons/suporte_icon.png" alt="">
                    <a href="perfilSuporte.html">
                        <h2 class="item">Suporte</h2>
                    </a>
                </div>
            </div>
            <hr>
            <div class="sair">
                <a href="index.html"><img src="assets/icons/saida_icon.png" alt=""></a>
            </div>

        </div>
        <div class="main-content" style="background-color: #f9f9f9;">

            <!-- Component header -->
            <div class="itens-navbar">
                <button class="button-navbar">Download Cliente</button>
                <img class="img-navbar" src="../public/assets/img/icone-avatar-default.png" alt="">
            </div>
            <!-- Component header -->

            <div class="background">
                <div class="content">
                    <div class="informationAndInputs">
                        <div class="iconBack"><a href="PrimaryDashboard.html"><i class="fa-solid fa-arrow-left"></i></a>
                        </div>


                    </div>

                    <div class="cardAndChartBackground">
                        <div class="cardInfoMaquinaBackground">
                            <div class="content" id="listaInformacoes">
                                <h2>Maquina 2</h2>
                                <div class="infosMaquina">
                                    <div class="itemInfoMaquina">
                                        <h4>Processado</h4>
                                        <p>Microsoft</p>
                                    </div>

                                    <div class="itemInfoMaquina">
                                        <h4>Arquitetura</h4>
                                        <p>64 bits</p>
                                    </div>
                                    <div class="itemInfoMaquina">
                                        <h4>SO</h4>
                                        <p>Windows</p>
                                    </div>
                                </div>


                                <div class="activeTime">
                                    <h4>Tempo de atividade</h4>
                                    <h3>10:00:10</h3>
                                </div>
                            </div>
                        </div>

                        <div class="lineChartBackground">
                            <div class="content">
                                <div class="infosOfLineChart">
                                    <h3>
                                        Grafico do componente
                                    </h3>

                                    <div class="selects">
                                        <h3>Componente:</h3>
                                        <select name="" id="selectComponente" onchange="iniciarGrafico()">
                                            <option value="RAM"> RAM</option>
                                            <option value="CPU"> CPU</option>
                                            <option value="Disco"> Disco</option>
                                        </select>
                                    </div>
                                    <span id="maquinaAtual"></span>
                                </div>

                                <div class="chartline">
                                    <canvas height="70%" id="myChart"></canvas>
                                </div>
                                <script>

                                    let hostName = sessionStorage.NOME_MAQUINA;
                                    let maquinaAtual = document.getElementById("maquinaAtual");

                                    var proximaAtualizacao;
                                    maquinaAtual.innerHTML = hostName;

                                    // function coletarDados() {
                                    //     if (proximaAtualizacao != undefined) {
                                    //         clearTimeout(proximaAtualizacao);
                                    //     }

                                    // }

                                    function iniciarGrafico() {
                                        let componenteSelecionado = document.getElementById("selectComponente").value;
                                       
                                        const horaRegistro = []
                                        const dadosCPU = []
                                        const data = {
                                            labels: horaRegistro,
                                            datasets: [{
                                                label: componenteSelecionado,
                                                backgroundColor: '#28AEF3',
                                                borderColor: '#28AEF3',
                                                data: dadosCPU,
                                            }]
                                        };

                                        const config = {
                                            type: 'line',
                                            data: data,
                                            options: {}
                                        };

                                        const chart = new Chart(
                                            document.getElementById('myChart'),
                                            config
                                        );
                                        
                                        setTimeout(() => atualizarGrafico(chart), 2000);

                                    }






                                    let contador = []
                                    function atualizarGrafico(chart) {
                                        fetch(`registro/registroGraficoLinhaTempo/${hostName}`, {
                                            method: "GET",
                                            headers: { "Content-Type": "application/json" }
                                        }).then(function (resposta) {
                                            resposta.json().then(function (resultado) {

                                                console.log('resultado', resultado)
                                                contador.push(1)
                                                const horaRegistro = resultado.map(dataRegistrada => dataRegistrada.data_registro);
                                                const dadosCPU = resultado.map(dadoCPU => dadoCPU.cpu_uso);
                                                console.log(horaRegistro)
                                                console.log(dadosCPU)
                                                if (contador.length >= 10) {

                                                    chart.data.datasets[0].data.shift();
                                                    chart.data.labels.shift()
                                                }

                                                chart.data.labels.push(horaRegistro);
                                                chart.data.datasets[0].data.push(resultado[0].cpu_uso);
                                                if(document.getElementById("selectComponente").value == "RAM"){
                                                chart.data.datasets[0].label= document.getElementById("selectComponente").value
                                                chart.update();
                                            }
                                            else if(document.getElementById("selectComponente").value == "CPU"){
                                                chart.data.datasets[0].label= document.getElementById("selectComponente").value
                                                chart.update();
                                            }
                                            else{
                                                chart.data.datasets[0].label= document.getElementById("selectComponente").value
                                                chart.update();
                                            }
                                                chart.update();
                                                proximaAtualizacao = setTimeout(() => atualizarGrafico(chart), 2000);

                                                if (resposta.ok) {
                                                    console.log("resposta: ", resposta.json());



                                                } else {
                                                    throw ("Houve um erro ao tentar realizar a busca por data!");
                                                }
                                            }).catch(function (res) {
                                                console.log("#ERRO: "`${res}`);
                                            });
                                        })

                                    }

                                </script>
                            </div>
                        </div>
                    </div>

                    <div class="bottomPart">

                        <div class="componentsAndProcessos">

                            <div class="backgroundComponents">
                                <div class="background">
                                    <div class="content" id="dadosComponentes">
                                        <div class="infoComponents">
                                            <p>Componentes</p>
                                            <h3 id="h3NomeMaquina">Máquina 3</h3>
                                        </div>

                                        <div class="labelsComponents">
                                            <p>#</p>
                                            <p>Nome</p>
                                            <p>Porcentagem em uso</p>
                                        </div>

                                        <div class="contentOfProgressBarComponents">

                                            <div class="itemProgressBarComponents">
                                                <h4>01</h4>
                                                <h5>RAM</h5>
                                                <div class="progressBarFullComponent">
                                                    <div class="progressBarInsideComponentRam divVermelhoComponent"
                                                        id="alterarRam">

                                                    </div>
                                                </div>

                                                <div class="porcentComponent porcentComponentVermelho">
                                                    <span>0</span>%
                                                </div>
                                            </div>

                                            <div class="itemProgressBarComponents">
                                                <h4>01</h4>
                                                <h5>CPU</h5>
                                                <div class="progressBarFullComponent"
                                                    id="progressBarInsideComponentCpu">
                                                    <div class="progressBarInsideComponentCpu">

                                                    </div>
                                                </div>

                                                <div class="porcentComponent porcentComponentAzulClaro">
                                                    <span>0</span>%
                                                </div>
                                            </div>

                                            <div class="itemProgressBarComponents">
                                                <h4>02</h4>
                                                <h5>DISCO</h5>
                                                <div class="progressBarFullComponent">
                                                    <div class="progressBarInsideComponentDisco divAmarelaComponent"
                                                        id="alterarDisco">

                                                    </div>
                                                </div>

                                                <div class="porcentComponent porcentComponentAmarelo">
                                                    <span>0</span>%
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="backgroundProcessos">

                                <div class="background">
                                    <div class="content">
                                        <div class="infoProcessos">
                                            <p>Processos</p>
                                        </div>

                                        <div class="labelsProcessos">
                                            <p>PID</p>
                                            <p>Nome</p>
                                            <p>Uso CPU</p>
                                            <p>Uso Memória</p>
                                        </div>

                                        <div class="contentOfProgressBarProcess">
                                            <!-- Item Processo -->
                                            <div class="itemProgressBarProcess">
                                                <h4>01</h4>
                                                <h5>Processo</h5>
                                                <div class="progressBarFullProcess">
                                                    <div class="progressBarInsideProcess divVermelhoComponent">

                                                    </div>
                                                </div>

                                                <div class="porcentProcess porcentComponentVermelho">
                                                    <span>46</span>%
                                                </div>

                                                <div class="progressBarFullProcess">
                                                    <div class="progressBarInsideProcess divVermelhoComponent">

                                                    </div>
                                                </div>

                                                <div class="porcentProcess porcentComponentVermelho">
                                                    <span>46</span>%
                                                </div>
                                            </div>
                                            <!--  -->
                                            <!-- Item Processo -->
                                            <div class="itemProgressBarProcess">
                                                <h4>01</h4>
                                                <h5>Processo</h5>
                                                <div class="progressBarFullProcess">
                                                    <div class="progressBarInsideProcess divAzulClaroComponent">

                                                    </div>
                                                </div>

                                                <div class="porcentProcess porcentComponentAzulClaro">
                                                    <span>46</span>%
                                                </div>

                                                <div class="progressBarFullProcess">
                                                    <div class="progressBarInsideProcess divAzulClaroComponent">

                                                    </div>
                                                </div>

                                                <div class="porcentProcess porcentComponentAzulClaro">
                                                    <span>46</span>%
                                                </div>
                                            </div>
                                            <!--  -->
                                            <!-- Item Processo -->
                                            <div class="itemProgressBarProcess">
                                                <h4>01</h4>
                                                <h5>Processo</h5>
                                                <div class="progressBarFullProcess">
                                                    <div class="progressBarInsideProcess divAmarelaComponent">

                                                    </div>
                                                </div>

                                                <div class="porcentProcess porcentComponentAmarelo">
                                                    <span>46</span>%
                                                </div>

                                                <div class="progressBarFullProcess">
                                                    <div class="progressBarInsideProcess divAmarelaComponent">

                                                    </div>
                                                </div>

                                                <div class="porcentProcess porcentComponentAmarelo">
                                                    <span>46</span>%
                                                </div>
                                            </div>
                                            <!--  -->
                                            <!-- Item Processo -->
                                            <div class="itemProgressBarProcess">
                                                <h4>01</h4>
                                                <h5>Processo</h5>
                                                <div class="progressBarFullProcess">
                                                    <div class="progressBarInsideProcess divAmarelaComponent">

                                                    </div>
                                                </div>

                                                <div class="porcentProcess porcentComponentAmarelo">
                                                    <span>46</span>%
                                                </div>

                                                <div class="progressBarFullProcess">
                                                    <div class="progressBarInsideProcess divAmarelaComponent">

                                                    </div>
                                                </div>

                                                <div class="porcentProcess porcentComponentAmarelo">
                                                    <span>46</span>%
                                                </div>
                                            </div>
                                            <!--  -->
                                            <!-- Item Processo -->
                                            <div class="itemProgressBarProcess">
                                                <h4>01</h4>
                                                <h5>Processo</h5>
                                                <div class="progressBarFullProcess">
                                                    <div class="progressBarInsideProcess divAmarelaComponent">

                                                    </div>
                                                </div>

                                                <div class="porcentProcess porcentComponentAmarelo">
                                                    <span>46</span>%
                                                </div>

                                                <div class="progressBarFullProcess">
                                                    <div class="progressBarInsideProcess divAmarelaComponent">

                                                    </div>
                                                </div>

                                                <div class="porcentProcess porcentComponentAmarelo">
                                                    <span>46</span>%
                                                </div>
                                            </div>
                                            <!--  -->
                                        </div>
                                    </div>
                                </div>

                            </div>

                        </div>

                        <div class="KpisAndServicos">
                            <div class="backgroundKPIS">
                                <div class="itemKPI">
                                    <h4>Processos</h4>
                                    <h2>30</h2>
                                </div>
                                <div class="itemKPI">
                                    <h4>Serviços</h4>
                                    <h2>40</h2>
                                </div>
                            </div>

                            <div class="backgroundServicos">
                                <div class="background">
                                    <div class="legendaServicos">

                                        <h4>Serviços</h4>

                                        <div class="divItens">
                                            <div class="itemLegenda">
                                                <div class="radius divVerde"></div>
                                                <p>Rodando</p>
                                            </div>

                                            <div class="itemLegenda">
                                                <div class="radius divCinza"></div>
                                                <p>Parado</p>
                                            </div>
                                        </div>

                                    </div>

                                    <div class="contentServices">

                                        <div class="servicoItem">
                                            <div class="divisActive divVerde"></div>
                                            <div class="content">
                                                <h4>Mysql</h4>
                                                <p>PID</p>
                                            </div>
                                        </div>

                                        <div class="servicoItem">
                                            <div class="divisActive divVerde"></div>
                                            <div class="content">
                                                <h4>Mysql</h4>
                                                <p>PID</p>
                                            </div>
                                        </div>

                                        <div class="servicoItem">
                                            <div class="divisActive divVerde"></div>
                                            <div class="content">
                                                <h4>Mysql</h4>
                                                <p>PID</p>
                                            </div>
                                        </div>

                                        <div class="servicoItem">
                                            <div class="divisActive divVerde"></div>
                                            <div class="content">
                                                <h4>Mysql</h4>
                                                <p>PID</p>
                                            </div>
                                        </div>

                                        <div class="servicoItem">
                                            <div class="divisActive divVerde"></div>
                                            <div class="content">
                                                <h4>Mysql</h4>
                                                <p>PID</p>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

        </div>
    </div>
    <script src="js/dashBoards/maquinaDashboard.js"></script>
</body>

</html>